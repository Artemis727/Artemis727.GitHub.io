[{"title":"SQL-åˆ·é¢˜ç¬”è®°","url":"/2023/02/07/SQL%20%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/","content":"1. æŸ¥è¯¢åˆ—# æŸ¥è¯¢æ‰€æœ‰åˆ—SELECT * FROM user_profile# æŸ¥è¯¢å¤šåˆ—SELECT device_id, gender, age, university FROM user_profile# æŸ¥è¯¢ç»“æœå»é‡SELECT DISTINCT university FROM user_profile# æŸ¥è¯¢ç»“æœé™åˆ¶è¿”å›è¡Œæ•°SELECT device_id FROM user_profile LIMIT 2# æŸ¥è¯¢åé‡å‘½åSELECT device_id FROM user_profile AS user_infos_example LIMIT 2# å¦å®šæŸ¥è¯¢select device_id, gender, age, universityfrom user_profilewhere not university = &#x27;å¤æ—¦å¤§å­¦&#x27;# è¿‡æ»¤ç©ºå€¼select device_id, gender, age, universityfrom user_profilewhere not age is null# inselect device_id, gender, age, university, gpa from user_profilewhere university in (&#x27;åŒ—äº¬å¤§å­¦&#x27;, &#x27;å¤æ—¦å¤§å­¦&#x27;, &#x27;å±±ä¸œå¤§å­¦&#x27;)# likeselect device_id, age, universityfrom user_profilewhere university like &#x27;%åŒ—äº¬%&#x27;# max() min()select max(gpa)from user_praofilewhere university = &#x27;å¤æ—¦å¤§å­¦&#x27;# avg() count()select count(gender) as male_num, avg(gpa) as avg_gpafrom user_profilewhere gender = &#x27;male&#x27;# havingselect university, avg(question_cnt) avg_question_cnt, avg(answer_cnt) avg_answer_cntfrom user_profilegroup by universityhaving avg_question_cnt &lt; 5 or avg_answer_cnt &lt; 20# ç”Ÿæˆæ–°å­—æ®µåä¸èƒ½ç”¨whereè¦ç”¨having\n\n\n\n2. æ¶‰åŠåˆ°å¤šä¸ªè¡¨çš„æƒ…å†µselect university, (count(q.question_id)/count(distinct(q.device_id))) avg_answer_cntfrom user_profile ujoin question_practice_detail qon u.device_id = q.device_idgroup by universityorder by university asc\n\nselect u.university, q.difficult_level, count(qp.question_id)/count(distinct qp.device_id) avg_answer_cntfrom user_profile u, question_practice_detail qp, question_detail qwhere u.university = &#x27;å±±ä¸œå¤§å­¦&#x27; and u.device_id = qp.device_id and q.question_id = qp.question_idgroup by u.university, difficult_levelorder by avg_answer_cnt\n\n\n\nSQL25 æŸ¥æ‰¾å±±ä¸œå¤§å­¦æˆ–è€…æ€§åˆ«ä¸ºç”·ç”Ÿçš„ä¿¡æ¯é¢˜ç›®ï¼šç°åœ¨è¿è¥æƒ³è¦åˆ†åˆ«æŸ¥çœ‹å­¦æ ¡ä¸ºå±±ä¸œå¤§å­¦æˆ–è€…æ€§åˆ«ä¸ºç”·æ€§çš„ç”¨æˆ·çš„device_idã€genderã€ageå’Œgpaæ•°æ®ï¼Œè¯·å–å‡ºç›¸åº”ç»“æœï¼Œç»“æœä¸å»é‡ã€‚\nç¤ºä¾‹ï¼šuser_profile\n\n\n\nid\ndevice_id\ngender\nage\nuniversity\ngpa\nactive_days_within_30\nquestion_cnt\nanswer_cnt\n\n\n\n1\n2138\nmale\n21\nåŒ—äº¬å¤§å­¦\n3.4\n7\n2\n12\n\n\n2\n3214\nmale\n\nå¤æ—¦å¤§å­¦\n4\n15\n5\n25\n\n\n3\n6543\nfemale\n20\nåŒ—äº¬å¤§å­¦\n3.2\n12\n3\n30\n\n\n4\n2315\nfemale\n23\næµ™æ±Ÿå¤§å­¦\n3.6\n5\n1\n2\n\n\n5\n5432\nmale\n25\nå±±ä¸œå¤§å­¦\n3.8\n20\n15\n70\n\n\n6\n2131\nmale\n28\nå±±ä¸œå¤§å­¦\n3.3\n15\n7\n13\n\n\n7\n4321\nmale\n26\nå¤æ—¦å¤§å­¦\n3.6\n9\n6\n52\n\n\næ ¹æ®ç¤ºä¾‹ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼ˆæ³¨æ„è¾“å‡ºçš„é¡ºåºï¼Œå…ˆè¾“å‡ºå­¦æ ¡ä¸ºå±±ä¸œå¤§å­¦å†è¾“å‡ºæ€§åˆ«ä¸ºç”·ç”Ÿçš„ä¿¡æ¯ï¼‰ï¼š\n\n\n\ndevice_id\ngender\nage\ngpa\n\n\n\n5432\nmale\n25\n3.8\n\n\n2131\nmale\n28\n3.3\n\n\n2138\nmale\n21\n3.4\n\n\n3214\nmale\nNone\n4\n\n\n5432\nmale\n25\n3.8\n\n\n2131\nmale\n28\n3.3\n\n\n4321\nmale\n28\n3.6\n\n\nselect device_id, gender, age, gpafrom user_profilewhere university = &#x27;å±±ä¸œå¤§å­¦&#x27;union all select device_id, gender, age, gpafrom user_profilewhere gender = &#x27;male&#x27;\n\n\n\n3. ifSQL26 è®¡ç®—25å²ä»¥ä¸Šå’Œä»¥ä¸‹çš„ç”¨æˆ·æ•°é‡é¢˜ç›®ï¼šç°åœ¨è¿è¥æƒ³è¦å°†ç”¨æˆ·åˆ’åˆ†ä¸º25å²ä»¥ä¸‹å’Œ25å²åŠä»¥ä¸Šä¸¤ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹è¿™ä¸¤ä¸ªå¹´é¾„æ®µç”¨æˆ·æ•°é‡\næœ¬é¢˜æ³¨æ„ï¼šageä¸ºnull ä¹Ÿè®°ä¸º 25å²ä»¥ä¸‹\nç¤ºä¾‹ï¼šuser_profile\n\n\n\nid\ndevice_id\ngender\nage\nuniversity\ngpa\nactive_days_within_30\nquestion_cnt\nanswer_cnt\n\n\n\n1\n2138\nmale\n21\nåŒ—äº¬å¤§å­¦\n3.4\n7\n2\n12\n\n\n2\n3214\nmale\n\nå¤æ—¦å¤§å­¦\n4\n15\n5\n25\n\n\n3\n6543\nfemale\n20\nåŒ—äº¬å¤§å­¦\n3.2\n12\n3\n30\n\n\n4\n2315\nfemale\n23\næµ™æ±Ÿå¤§å­¦\n3.6\n5\n1\n2\n\n\n5\n5432\nmale\n25\nå±±ä¸œå¤§å­¦\n3.8\n20\n15\n70\n\n\n6\n2131\nmale\n28\nå±±ä¸œå¤§å­¦\n3.3\n15\n7\n13\n\n\n7\n4321\nmale\n26\nå¤æ—¦å¤§å­¦\n3.6\n9\n6\n52\n\n\næ ¹æ®ç¤ºä¾‹ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š\n\n\n\nage_cut\nnumber\n\n\n\n25å²ä»¥ä¸‹\n4\n\n\n25å²åŠä»¥ä¸Š\n3\n\n\nselect age_cut, count(device_id) numberfrom(select if(age &gt;= 25, &#x27;25å²åŠä»¥ä¸Š&#x27;, &#x27;25å²ä»¥ä¸‹&#x27;) as age_cut, device_id from user_profile) t1group by age_cut\n\n\n\n4. caseSQL27 æŸ¥çœ‹ä¸åŒå¹´é¾„æ®µçš„ç”¨æˆ·æ˜ç»†é¢˜ç›®ï¼šç°åœ¨è¿è¥æƒ³è¦å°†ç”¨æˆ·åˆ’åˆ†ä¸º20å²ä»¥ä¸‹ï¼Œ20-24å²ï¼Œ25å²åŠä»¥ä¸Šä¸‰ä¸ªå¹´é¾„æ®µï¼Œåˆ†åˆ«æŸ¥çœ‹ä¸åŒå¹´é¾„æ®µç”¨æˆ·çš„æ˜ç»†æƒ…å†µï¼Œè¯·å–å‡ºç›¸åº”æ•°æ®ã€‚ï¼ˆæ³¨ï¼šè‹¥å¹´é¾„ä¸ºç©ºè¯·è¿”å›å…¶ä»–ã€‚ï¼‰\nç¤ºä¾‹ï¼šuser_profile\n\n\n\nid\ndevice_id\ngender\nage\nuniversity\ngpa\nactive_days_within_30\nquestion_cnt\nanswer_cnt\n\n\n\n1\n2138\nmale\n21\nåŒ—äº¬å¤§å­¦\n3.4\n7\n2\n12\n\n\n2\n3214\nmale\n\nå¤æ—¦å¤§å­¦\n4\n15\n5\n25\n\n\n3\n6543\nfemale\n20\nåŒ—äº¬å¤§å­¦\n3.2\n12\n3\n30\n\n\n4\n2315\nfemale\n23\næµ™æ±Ÿå¤§å­¦\n3.6\n5\n1\n2\n\n\n5\n5432\nmale\n25\nå±±ä¸œå¤§å­¦\n3.8\n20\n15\n70\n\n\n6\n2131\nmale\n28\nå±±ä¸œå¤§å­¦\n3.3\n15\n7\n13\n\n\n7\n4321\nmale\n26\nå¤æ—¦å¤§å­¦\n3.6\n9\n6\n52\n\n\næ ¹æ®ç¤ºä¾‹ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š\n\n\n\ndevice_id\ngender\nage_cut\n\n\n\n2138\nmale\n20-24å²\n\n\n3214\nmale\nå…¶ä»–\n\n\n6543\nfemale\n20-24å²\n\n\n2315\nfemale\n20-24å²\n\n\n5432\nmale\n25å²åŠä»¥ä¸Š\n\n\n2131\nmale\n25å²åŠä»¥ä¸Š\n\n\n4321\nmale\n25å²åŠä»¥ä¸Š\n\n\nselect device_id, gender, case    when age &lt; 20 then &#x27;20å²ä»¥ä¸‹&#x27;    when age &lt; 25 then &#x27;20-24å²&#x27;    when age &gt;= 25 then &#x27;25å²åŠä»¥ä¸Š&#x27;    else &#x27;å…¶ä»–&#x27;end age_cutfrom user_profile\n\n\n\n5. day()\nday()\n\nmonth()\n\nyear()\n\n\n6. ç”¨æˆ·ç•™å­˜ç‡è®¡ç®—SQL-è®¡ç®—ç”¨æˆ·æ¬¡æ—¥ç•™å­˜ç‡.md\n7. å­—ç¬¦ä¸²ç›¸å…³SQL-å­—ç¬¦ä¸²ç›¸å…³.md\n","categories":["Programming","SQL"],"tags":["SQL","åˆ·é¢˜ç¬”è®°"]},{"title":"SQL-å­—ç¬¦ä¸²ç›¸å…³","url":"/2023/02/07/SQL-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/","content":"SQL30 ç»Ÿè®¡æ¯ç§æ€§åˆ«çš„äººæ•°æè¿°é¢˜ç›®ï¼šç°åœ¨è¿è¥ä¸¾åŠäº†ä¸€åœºæ¯”èµ›ï¼Œæ”¶åˆ°äº†ä¸€äº›å‚èµ›ç”³è¯·ï¼Œè¡¨æ•°æ®è®°å½•å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œç°åœ¨è¿è¥æƒ³è¦ç»Ÿè®¡æ¯ä¸ªæ€§åˆ«çš„ç”¨æˆ·åˆ†åˆ«æœ‰å¤šå°‘å‚èµ›è€…ï¼Œè¯·å–å‡ºç›¸åº”ç»“æœ\nç¤ºä¾‹ï¼šuser_submit\n\n\n\ndevice_id\nprofile\nblog_url\n\n\n\n2138\n180cm,75kg,27,male\nhttp:&#x2F;url&#x2F;bigboy777\n\n\n3214\n165cm,45kg,26,female\nhttp:&#x2F;url&#x2F;kittycc\n\n\n6543\n178cm,65kg,25,male\nhttp:&#x2F;url&#x2F;tiger\n\n\n4321\n171cm,55kg,23,female\nhttp:&#x2F;url&#x2F;uhksd\n\n\n2131\n168cm,45kg,22,female\nhttp:&#x2F;urlsydney\n\n\næ ¹æ®ç¤ºä¾‹ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š\n\n\n\ngender\nnumber\n\n\n\nmale\n2\n\n\nfemale\n3\n\n\n\nselect substring_index(profile, &#x27;,&#x27;, -1) as gender, count(device_id)from user_submitgroup by gender\n\n\n\nSQL31 æå–åšå®¢URLä¸­çš„ç”¨æˆ·åæè¿°é¢˜ç›®ï¼šå¯¹äºç”³è¯·å‚ä¸æ¯”èµ›çš„ç”¨æˆ·ï¼Œblog_urlå­—æ®µä¸­urlå­—ç¬¦åçš„å­—ç¬¦ä¸²ä¸ºç”¨æˆ·ä¸ªäººåšå®¢çš„ç”¨æˆ·åï¼Œç°åœ¨è¿è¥æƒ³è¦æŠŠç”¨æˆ·çš„ä¸ªäººåšå®¢ç”¨æˆ·å­—æ®µæå–å‡ºå•ç‹¬è®°å½•ä¸ºä¸€ä¸ªæ–°çš„å­—æ®µï¼Œè¯·å–å‡ºæ‰€éœ€æ•°æ®ã€‚\nç¤ºä¾‹ï¼šuser_submit\n\n\n\ndevice_id\nprofile\nblog_url\n\n\n\n2138\n180cm,75kg,27,male\nhttp:&#x2F;ur&#x2F;bisdgboy777\n\n\n3214\n165cm,45kg,26,female\nhttp:&#x2F;url&#x2F;dkittycc\n\n\n6543\n178cm,65kg,25,male\nhttp:&#x2F;ur&#x2F;tigaer\n\n\n4321\n171 cm,55kg,23,female\nhttp:&#x2F;url&#x2F;uhksd\n\n\n2131\n168cm,45kg,22,female\nhttp:&#x2F;url&#x2F;sydney\n\n\næ ¹æ®ç¤ºä¾‹ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š\n\n\n\ndevice_id\nuser_name\n\n\n\n2138\nbisdgboy777\n\n\n3214\ndkittycc\n\n\n6543\ntigaer\n\n\n4321\nuhsksd\n\n\n2131\nsydney\n\n\n\næå–æŸä¸ªå­—ç¬¦ä¸€èˆ¬æœ‰å››ç§åšæ³•ï¼š\ntrim()\ntrim() æ˜¯ç›´æ¥æ›´æ”¹ç›¸åŒæ ¼å¼çš„ä¸€åˆ—ï¼Œåˆ é™¤è¿™ä¸€åˆ—å†…å®¹ä¸­çš„ç»Ÿä¸€éƒ¨åˆ†ï¼Œç„¶åé‡å‘½åï¼š\nselect device_id, trim(&#x27;http:/url/&#x27; from blog_url) as user_namefrom user_submit\n\nâ€‹\t\n\nsubstring_index()\nsubstring_index() æ˜¯å°†å­—ç¬¦ä¸²åˆ‡å‰²ï¼Œ1è¡¨ç¤ºä¿ç•™å­—ç¬¦ä¸²çš„å·¦è¾¹ğŸ‘ˆï¼Œ-1è¡¨ç¤ºä¿ç•™å­—ç¬¦ä¸²çš„å³è¾¹ğŸ‘‰ï¼š\nselect device_id, substring_index(blog_url, &#x27;/url/&#x27;, -1) as user_namefrom user_submit\n\nè¿˜æœ‰ä¸€ä¸ªç”¨æ³•æ˜¯è®¡æ•°ï¼š\nSUBSTRING_INDEX(str,delim,count) è¿”å›ä»å­—ç¬¦ä¸²stråˆ†éš”ç¬¦ delim åœ¨è®¡æ•°å‘ç”Ÿå‰çš„å­å­—ç¬¦ä¸²ã€‚å¦‚æœè®¡æ•°æ˜¯æ­£çš„ï¼Œåˆ™è¿”å›ä¸€åˆ‡åˆ°æœ€ç»ˆå®šç•Œç¬¦(ä»å·¦è¾¹ç®—èµ·)çš„å·¦ä¾§ã€‚å¦‚æœcountæ˜¯è´Ÿæ•°ï¼Œåˆ™è¿”å›ä¸€åˆ‡æœ€ç»ˆå®šç•Œç¬¦(ä»å³è¾¹ç®—èµ·)çš„å³ä¾§ã€‚SUBSTRING_INDEX() æœå¯»åœ¨delimæ—¶è¿›è¡ŒåŒºåˆ†å¤§å°å†™çš„åŒ¹é…ã€‚\nSELECT SUBSTRING_INDEX(&#x27;www.somewebsite.com&#x27;,&#x27;.&#x27;,2);\n\nOutput: &#39;www.somewebsite&#39;\n\nsubstr()\nsubstr() æ˜¯ç”¨å…·ä½“ä½ç½®ï¼ˆæ•°å­—ï¼‰æ¥è¡¨ç¤ºä»å“ªå¼€å§‹æˆªå–çš„ï¼Œå‚æ•°é‡Œè¿˜åŒ…æ‹¬æˆªå–çš„é•¿åº¦ï¼š\nselect device_id, substr(blog_url, 11, length(blog_url)-10) as user_namefrom user_submit\n\n\n\nreplace()\nreplace() å°±æ˜¯æ›¿æ¢å‡½æ•°ï¼š\nsleect device_id, replace(blog_url, &#x27;http:/url/&#x27;, &#x27;&#x27;) as user_namefrom user_submit\n\nSQL32 æˆªå–å‡ºå¹´é¾„æè¿°é¢˜ç›®ï¼šç°åœ¨è¿è¥ä¸¾åŠäº†ä¸€åœºæ¯”èµ›ï¼Œæ”¶åˆ°äº†ä¸€äº›å‚èµ›ç”³è¯·ï¼Œè¡¨æ•°æ®è®°å½•å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œç°åœ¨è¿è¥æƒ³è¦ç»Ÿè®¡æ¯ä¸ªå¹´é¾„çš„ç”¨æˆ·åˆ†åˆ«æœ‰å¤šå°‘å‚èµ›è€…ï¼Œè¯·å–å‡ºç›¸åº”ç»“æœ\nç¤ºä¾‹ï¼šuser_submit\n\n\n\ndevice_id\nprofile\nblog_url\n\n\n\n2138\n180cm,75kg,27,male\nhttp:&#x2F;ur&#x2F;bigboy777\n\n\n3214\n165cm,45kg,26,female\nhttp:&#x2F;url&#x2F;kittycc\n\n\n6543\n178cm,65kg,25,male\nhttp:&#x2F;url&#x2F;tiger\n\n\n4321\n171cm,55kg,23,female\nhttp:&#x2F;url&#x2F;uhksd\n\n\n2131\n168cm,45kg,22,female\nhttp:&#x2F;url&#x2F;sydney\n\n\næ ¹æ®ç¤ºä¾‹ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š\n\n\n\nage\nnumber\n\n\n\n27\n1\n\n\n26\n1\n\n\n25\n1\n\n\n23\n1\n\n\n22\n1\n\n\nselect substring_index(substring_index(profile, &#x27;,&#x27;, -2), &#x27;,&#x27;, 1) as age, count(device_id)from user_submitgroup by age\n\n","categories":["Programming","SQL"],"tags":["SQL","å­—ç¬¦ä¸²"]},{"title":"Hello World","url":"/2023/02/07/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n"},{"title":"SQL-è®¡ç®—ç”¨æˆ·ç•™å­˜ç‡","url":"/2023/02/07/SQL-%E8%AE%A1%E7%AE%97%E7%94%A8%E6%88%B7%E6%AC%A1%E6%97%A5%E7%95%99%E5%AD%98%E7%8E%87/","content":"è®¡ç®—ç”¨æˆ·æ¬¡æ—¥ç•™å­˜ç‡å¦‚æœåªæ˜¯è®¡ç®—ç”¨æˆ·çš„æ¬¡æ—¥ç•™å­˜ç‡ï¼Œé‚£ä¹ˆä½¿ç”¨date_sub()å‡½æ•°å°±å¤Ÿäº†ï¼š\nselect avg(if(b.device_id is not null, 1, 0)) as avg_retfrom(    select distinct device_id, date    from question_practice_detail) aleft join(    select distinct device_id, date_sub(date, interval 1 day) as date    from question_practice_detail) bon a.device_id = b.device_id and a.date = b.date\n\n\ndate_sub() å‡½æ•°ï¼š\n\nSELECT DATE_SUB(â€˜2010-08-12â€™, INTERVAL 3 DAY) AS NewDate \nç»“æœï¼š 2010-08-09\n\nSELECT DATE_SUB(â€˜2010-08-12â€™, INTERVAL â€˜3-2â€™ YEAR_MONTH) AS NewDate \nç»“æœï¼š 2007-06-12\n\nSELECT DATE_SUB(â€˜2011-09-14 2:44:36â€™, INTERVAL â€˜2:26â€™ HOUR_MINUTE) AS NewDate \nç»“æœï¼š 2011-09-14 00:18:36\n\n\n\n\nåŸºäºSQLçš„ç•™å­˜ç‡è®¡ç®—\nè½¬è‡ªçŸ¥ä¹ï¼šåŸºäºSQLçš„ç•™å­˜ç‡è®¡ç®—\n\nä¸€ã€ä»€ä¹ˆæ˜¯ç•™å­˜ç‡äº’è”ç½‘è¡Œä¸šé‡Œï¼Œç•™å­˜ç‡æ˜¯ç”¨äºåæ˜ ç½‘ç«™ã€äº’è”ç½‘åº”ç”¨æˆ–ç½‘ç»œæ¸¸æˆçš„è¿è¥æƒ…å†µçš„ç»Ÿè®¡æŒ‡æ ‡ï¼Œå…¶å…·ä½“å«ä¹‰ä¸ºåœ¨ç»Ÿè®¡å‘¨æœŸï¼ˆå‘¨&#x2F;æœˆï¼‰å†…ï¼Œæ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°åœ¨ç¬¬Næ—¥ä»å¯åŠ¨è¯¥Appçš„ç”¨æˆ·æ•°å æ¯”çš„å¹³å‡å€¼ã€‚å…¶ä¸­Né€šå¸¸å–2ã€3ã€7ã€14ã€30ï¼Œåˆ†åˆ«å¯¹åº”æ¬¡æ—¥ç•™å­˜ç‡ã€ä¸‰æ—¥ç•™å­˜ç‡ã€å‘¨ç•™å­˜ç‡ã€åŠæœˆç•™å­˜ç‡å’Œæœˆç•™å­˜ç‡ã€‚\nç•™å­˜ç‡å¸¸ç”¨äºåæ˜ ç”¨æˆ·ç²˜æ€§ï¼Œå½“Nå–å€¼è¶Šå¤§ã€ç•™å­˜ç‡è¶Šé«˜æ—¶ï¼Œç”¨æˆ·ç²˜æ€§è¶Šé«˜ã€‚\näºŒã€ç•™å­˜ç‡çš„è®¡ç®—\nç•™å­˜ç‡ &#x3D; ç™»é™†ç”¨æˆ·æ•°&#x2F;æ–°å¢ç”¨æˆ·æ•° * 100%\n\næ–°å¢ç”¨æˆ·æ•°ï¼šåœ¨å½“å‰æ—¶é—´æ®µæ–°æ³¨å†Œï¼ˆæˆ–æ–°è®¿é—®ï¼‰çš„ç”¨æˆ·æ•°ï¼›\n\nç™»å½•ç”¨æˆ·æ•°ï¼šåœ¨ç»Ÿè®¡çš„æ—¶é—´æ®µè‡³å°‘ç™»å½•è¿‡ä¸€æ¬¡çš„ç”¨æˆ·æ•°ï¼›\n\næ¬¡æ—¥ç•™å­˜ç‡ï¼šåœ¨æ¬¡æ—¥è‡³å°‘ç™»å½•è¿‡ä¸€æ¬¡çš„ç”¨æˆ·æ•°&#x2F;å½“å¤©æ–°å¢çš„ç”¨æˆ·æ•°ï¼›\n\nâ—ï¸3æ—¥ç•™å­˜ç‡ï¼šåœ¨å¾€å3å¤©å†…è‡³å°‘ç™»å½•è¿‡ä¸€æ¬¡çš„ç”¨æˆ·æ•°&#x2F;å½“å¤©æ–°å¢çš„ç”¨æˆ·æ•°ï¼›\n\nâ—ï¸7æ—¥ç•™å­˜ç‡ï¼šåœ¨å¾€å7å¤©å†…è‡³å°‘ç™»å½•è¿‡ä¸€æ¬¡çš„ç”¨æˆ·æ•°&#x2F;å½“å¤©æ–°å¢çš„ç”¨æˆ·æ•°ï¼›\n\nâ—ï¸15æ—¥ç•™å­˜æ•°ï¼šå½“å¤©æ–°å¢çš„ç”¨æˆ·æ•°ï¼Œåœ¨å¾€å7å¤©å†…è‡³å°‘ç™»å½•è¿‡ä¸€æ¬¡çš„ç”¨æˆ·ï¼Œåœ¨å¾€åç¬¬8å¤©åˆ°ç¬¬14å¤©å†…è‡³å°‘å†ç™»é™†è¿‡ä¸€æ¬¡çš„ç”¨æˆ·æ•°\nâ¡ï¸ 3æ—¥å’Œ7æ—¥ï¼Œè‡³å°‘ç™»é™†è¿‡ä¸€æ¬¡ï¼›15æ—¥ï¼Œ7å¤©ä¸ºä¸€æ®µï¼Œåœ¨æ¯æ®µå†…è‡³å°‘ç™»å½•ä¸€æ¬¡ï¼\n\n\nSQLä¸­è®¡ç®—ç”¨æˆ·çš„ç•™å­˜ç‡\næ–°å¢ç”¨æˆ·æ•°\n\nç”±äºæ•°æ®è¿‡å¤§ï¼Œè¿™æˆªå–æ—¶é—´2017.11.26~2017.12.03ä¸ºä¾‹ã€‚\né¦–å…ˆè®¡ç®—åˆ†æ¯ï¼Œè¿™é‡Œæœ‰çš„ç®—æ³•æ˜¯ç”¨æ–°å¢ç”¨æˆ·æ•°ï¼Œæœ‰çš„ç®—æ³•æ˜¯ç”¨æ´»è·ƒç”¨æˆ·æ•°ã€‚\nâš ï¸æ³¨æ„ï¼šæ–°å¢ç”¨æˆ·æ•°ä¸æ´»è·ƒç”¨æˆ·æ•°å¹¶ä¸ç›¸ç­‰ï¼Œæ´»è·ƒç”¨æˆ·æ•°åŒ…å«æ–°å¢ç”¨æˆ·æ•°ã€‚æ´»è·ƒç”¨æˆ·æ•°ï¼Œå½“å¤©çš„è®¿é—®äººæ•°ï¼Œä¹Ÿå°±æ˜¯UVã€‚\n-- æ¯ä½ç”¨æˆ·çš„æœ€æ—©ç™»å½•æ—¥æœŸSELECT ç”¨æˆ·ID, MIN(æ—¥æœŸ) AS æœ€æ—©ç™»å½•æ—¥æœŸFROM userbehaviorWHERE æ—¥æœŸ &gt; &#x27;2017-11-25&#x27;AND æ—¥æœŸ &lt; &#x27;2017-12-04&#x27;GROUP BY ç”¨æˆ·ID\n\n\nå†ä»ä¸Šè¡¨ä¸­è®¡ç®—å‡ºæ¯å¤©çš„æ–°å¢äººæ•°ï¼Œâ—ï¸ç®—æ–°å¢äººæ•°ç”¨çš„æ—¥æœŸæ˜¯æœ€æ—©ç™»å½•æ—¥æœŸï¼\nSELECT æœ€æ—©ç™»å½•æ—¥æœŸ AS æ—¥æœŸ, COUNT(DISTINCT ç”¨æˆ·ID) AS æ–°å¢äººæ•°FROM(SELECT ç”¨æˆ·ID, MIN(æ—¥æœŸ) AS æœ€æ—©ç™»å½•æ—¥æœŸ     FROM userbehavior     WHERE æ—¥æœŸ &gt; &#x27;2017-11-25&#x27; AND æ—¥æœŸ &lt; &#x27;2017-12-04&#x27;     GROUP BY ç”¨æˆ·ID) AS fGROUP BY æœ€æ—©ç™»å½•æ—¥æœŸ\n\n\nä»¥ä¸‹æ˜¯æ´»è·ƒç”¨æˆ·æ•°çš„ç®—æ³•ï¼ŒäºŒè€…ç¡®å®æ•°å€¼ä¸Šå¹¶ä¸ç›¸ç­‰ã€‚â—ï¸ç®—æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°ç”¨çš„æ—¥æœŸå°±æ˜¯å½“å¤©çš„æ—¥æœŸï¼\n-- æ¯å¤©æ´»è·ƒç”¨æˆ·æ•°=UV è®¿å®¢æ•°SELECT æ—¥æœŸ, COUNT(DISTINCT ç”¨æˆ·ID) AS æ´»è·ƒç”¨æˆ·æ•°FROM userbehaviorwhere æ—¥æœŸ &gt;&#x27;2017-11-25&#x27; AND æ—¥æœŸ &lt; &#x27;2017-12-04&#x27;GROUP BY æ—¥æœŸ\n\n\næŠ½å–7å¤©çš„æ´»è·ƒç”¨æˆ·æ•°ã€‚\n\næ¬¡æ—¥ç•™å­˜çš„ç”¨æˆ·æ•°\n\n\næ¬¡æ—¥çš„æ—¶é—´é—´éš”ä¸º1ï¼Œæ¶‰åŠåˆ°æ—¶é—´é—´éš”é‡‡ç”¨è‡ªè”ç»“ã€‚\n\nSELECT a.ç”¨æˆ·ID, a.`æ—¥æœŸ` AS atime, b.`æ—¥æœŸ` AS btimeFROM userbehavior AS a LEFT JOIN userbehavior AS bON a.`ç”¨æˆ·ID` = b.`ç”¨æˆ·ID`WHERE a.`æ—¥æœŸ` &gt; &#x27;2017-11-25&#x27; AND a.`æ—¥æœŸ` &lt; &#x27;2017-12-04&#x27;\n\n\nå°†ä¸Šè¡¨å­˜ä¸ºè§†å›¾Cï¼Œ\nCREATE VIEW C(ç”¨æˆ·ID, atime, btime)ASSELECT a.ç”¨æˆ·ID, a.`æ—¥æœŸ`, b.`æ—¥æœŸ` from userbehavior AS a LEFT JOIN userbehavior AS bON a.`ç”¨æˆ·ID`=b.`ç”¨æˆ·ID`WHERE a.`æ—¥æœŸ`&gt;&#x27;2017-11-25&#x27;AND a.`æ—¥æœŸ` &lt; &#x27;2017-12-04&#x27;;\n\n\nè®¡ç®—æ—¶é—´é—´éš”ç”¨timestampdiffå‡½æ•°\n\nSELECT `ç”¨æˆ·ID`, TIMESTAMPDIFF(DAY, atime, btime)AS æ—¶é—´é—´éš”FROM (  SELECT a.ç”¨æˆ·ID, a.æ—¥æœŸ as atime, b.æ—¥æœŸ as btime  FROM userbehavior as a LEFT JOIN userbehavior as b  ON a.ç”¨æˆ·ID=b.`ç”¨æˆ·ID`  WHERE a.`æ—¥æœŸ`&gt;&#x27;2017-11-25&#x27;AND a.`æ—¥æœŸ` &lt; &#x27;2017-12-04&#x27;) AS c-- è¿™é‡Œç›´æ¥è®¾ç½®ä¸ºè¡¨c\n\n\nå¾—åˆ°äº†ç”¨æˆ·çš„æ—¶é—´é—´éš”\n3.ç”¨caseè¯­å¥ç­›é€‰å‡ºæ—¶é—´é—´éš”ä¸º1çš„æ•°æ®ï¼Œå¹¶ä¸”è¿›è¡Œè®¡æ•°\nSELECT *, COUNT(DISTINCT case when æ—¶é—´é—´éš” = 1 then `ç”¨æˆ·ID`\t\t\tELSE NULL\t\t\tEND)AS æ¬¡æ—¥ç•™å­˜æ•°FROM( SELECT `ç”¨æˆ·ID`,TIMESTAMPDIFF(DAY,atime,btime)AS æ—¶é—´é—´éš”\t\t\t FROM (\t\t\t\tSELECT a.ç”¨æˆ·ID,a.æ—¥æœŸ as atime,b.æ—¥æœŸ as btime\t\t\t\tFROM userbehavior as a LEFT JOIN userbehavior as b\t\t\t\tON a.ç”¨æˆ·ID=b.`ç”¨æˆ·ID`\t\t\t\tWHERE a.`æ—¥æœŸ`&gt;&#x27;2017-11-25&#x27;AND a.`æ—¥æœŸ` &lt; &#x27;2017-12-04&#x27;\t\t\t\t) AS c\t\t\t)AS d\n\n\næ¬¡æ—¥ç•™å­˜ç‡\n\næ¬¡æ—¥ç•™å­˜ç‡&#x3D;æ¬¡æ—¥ç•™å­˜ç”¨æˆ·æ•°&#x2F;å½“æ—¥æ´»è·ƒç”¨æˆ·æ•°\nSELECT *,COUNT(DISTINCT case when æ—¶é—´é—´éš” = 1 then `ç”¨æˆ·ID`\t\t\tELSE NULL\t\t\tEND) AS æ¬¡æ—¥ç•™å­˜æ•°/COUNT(DISTINCT ç”¨æˆ·ID) AS æ¬¡æ—¥ç•™å­˜ç‡FROM( SELECT `ç”¨æˆ·ID`,TIMESTAMPDIFF(DAY,atime,btime)AS æ—¶é—´é—´éš”\t\t\t FROM (\t\t\t\tSELECT a.ç”¨æˆ·ID,a.æ—¥æœŸ as atime,b.æ—¥æœŸ as btime\t\t\t\tFROM userbehavior as a LEFT JOIN userbehavior as b\t\t\t\tON a.ç”¨æˆ·ID=b.`ç”¨æˆ·ID`\t\t\t\tWHERE a.`æ—¥æœŸ`&gt;&#x27;2017-11-25&#x27;AND a.`æ—¥æœŸ` &lt; &#x27;2017-12-04&#x27;\t\t\t\t) AS c\t\t\t)AS d\n\n\n\nä¸‰ã€ä¸‰æ—¥ä»¥åŠNæ—¥ç•™å­˜çš„è®¡ç®—åªéœ€è¦ä¿®æ”¹æ—¶é—´é—´éš”&#x3D;Nå³å¯ã€‚\nSELECT æ—¥æœŸ,COUNT(DISTINCT ç”¨æˆ·ID AS æ´»è·ƒç”¨æˆ·æ•°,COUNT(DISTINCT case when æ—¶é—´é—´éš”=1 then `ç”¨æˆ·ID`\t\t\tELSE NULL\t\t\tEND) AS æ¬¡æ—¥ç•™å­˜æ•°/COUNT(DISTINCT ç”¨æˆ·ID) AS æ¬¡æ—¥ç•™å­˜ç‡COUNT(DISTINCT case when æ—¶é—´é—´éš”=3 then `ç”¨æˆ·ID`\t\t\tELSE NULL\t\t\tEND) AS æ¬¡æ—¥ç•™å­˜æ•°/COUNT(DISTINCT ç”¨æˆ·ID) AS ä¸‰æ—¥ç•™å­˜ç‡COUNT(DISTINCT case when æ—¶é—´é—´éš”=7 then `ç”¨æˆ·ID`\t\t\tELSE NULL\t\t\tEND) AS æ¬¡æ—¥ç•™å­˜æ•°/COUNT(DISTINCT ç”¨æˆ·ID) AS ä¸ƒæ—¥ç•™å­˜ç‡FROM( SELECT `ç”¨æˆ·ID`,TIMESTAMPDIFF(DAY,atime,btime)AS æ—¶é—´é—´éš”\t\t\t FROM (\t\t\t\tSELECT a.ç”¨æˆ·ID,a.æ—¥æœŸ as atime,b.æ—¥æœŸ as btime\t\t\t\tFROM userbehavior as a LEFT JOIN æ¯æ—¥æ–°å¢ç”¨æˆ·æ•°è¡¨ as b\t\t\t\tON a.ç”¨æˆ·ID=b.`ç”¨æˆ·ID`\t\t\t\tWHERE a.`æ—¥æœŸ`&gt;&#x27;2017-11-25&#x27;AND a.`æ—¥æœŸ` &lt; &#x27;2017-12-04&#x27;\t\t\t\t) AS c\t\t\t)AS d","categories":["Programming","SQL"],"tags":["SQL"]}]